<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#1e1e1e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Licznik Trzeźwości</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div id="app">
        <!-- Main List View -->
        <div id="view-list" class="view active">
            <div class="header">
                <h1>Moje Liczniki</h1>
                <p>Śledź swoje postępy</p>
            </div>
            
            <div id="counters-list" class="counters-list">
                <!-- Counters via JS -->
            </div>

            <button id="add-btn" class="fab">
                <i class="fas fa-plus"></i>
            </button>
        </div>

        <!-- Detail View -->
        <div id="view-detail" class="view">
            <div class="header-detail">
                <button id="back-btn" class="btn-icon">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h2 id="detail-title">Tytuł</h2>
                <div style="width: 40px;"></div> 
            </div>

            <!-- Detail View States Container -->
            <div id="detail-states">
                <!-- 1. Active State (Regular progress) -->
                <div id="active-state" class="detail-state hidden">
                    <div class="counter-display">
                        <div class="circle-progress">
                            <div class="inner-circle">
                                <div id="years-row" class="hidden"><span id="years-count">0</span><span class="unit">LAT</span></div>
                                <span id="days-count">0</span>
                                <span id="circle-unit-label" class="label">DNI</span>
                            </div>
                        </div>
                    </div>

                    <div id="countdown-details" class="details">
                        <div class="detail-item">
                            <span class="detail-label">Godziny</span>
                            <span id="hours-count" class="detail-value">00</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Minuty</span>
                            <span id="minutes-count" class="detail-value">00</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Sekundy</span>
                            <span id="seconds-count" class="detail-value">00</span>
                        </div>
                    </div>

                    <div class="quote-section">
                        <p id="quote-text">"Każdy dzień to nowa szansa."</p>
                    </div>
                </div>

                <!-- 2. Success State (Reached goal) -->
                <div id="success-state" class="detail-state hidden">
                    <div class="counter-display">
                        <div class="circle-progress success-ring">
                            <div class="inner-circle">
                                <i class="fas fa-trophy" style="font-size: 50px; color: var(--success); margin-bottom: 10px;"></i>
                                <span style="font-size: 18px; font-weight: 800; display: block; color: var(--success);">CEL OSIĄGNIĘTY!</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="success-actions" style="margin-top: 20px; text-align: center;">
                        <button id="continue-btn" class="btn btn-primary" style="background: var(--success); width: 100%;">
                            <i class="fas fa-calendar-plus"></i> Kontynuuj / Nowy cel
                        </button>
                    </div>
                </div>

                <!-- 3. Failed State (Ended streak) -->
                <div id="failed-state" class="detail-state hidden">
                    <div class="failed-card">
                        <i class="fas fa-flag-checkered icon-finish"></i>
                        <h2>Koniec passy</h2>
                        <p>Wytrwałeś przez:</p>
                        <div class="final-time">
                            <span id="final-years-row" class="hidden"><span id="final-years">0</span> lat </span>
                            <span id="final-days">0</span> dni<br>
                            <span id="final-hours">0</span> godz. <span id="final-minutes">0</span> min.
                        </div>
                        
                        <button id="restart-btn" class="btn btn-primary">
                            <i class="fas fa-redo"></i> Zacznij od nowa
                        </button>
                        
                        <div class="failed-actions">
                            <button id="undo-fail-btn" class="btn btn-secondary small-btn">
                                <i class="fas fa-undo"></i> Cofnij
                            </button>
                            <button id="delete-fail-btn" class="btn btn-secondary small-btn danger-text">
                                <i class="fas fa-trash-alt"></i> Usuń
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="controls-bottom">
                <button id="more-btn" class="btn btn-secondary">
                    <i class="fas fa-ellipsis-h-alt"></i> OPCJE
                </button>
            </div>

            <div class="info-card">
                <h3>Początek</h3>
                <p id="start-date">Brak danych</p>
            </div>
        </div>
        
        <!-- Add/Edit Counter Modal -->
        <div id="modal-add" class="modal">
            <div class="modal-content">
                <h3 id="modal-title">Nowy Licznik</h3>
                
                <div id="type-selector-wrapper">
                    <div class="type-selector">
                        <label class="type-option active" data-type="regular">
                            <i class="fas fa-arrow-up"></i> Od teraz
                            <small>Trzeźwość</small>
                        </label>
                        <label class="type-option" data-type="countdown">
                            <i class="fas fa-arrow-down"></i> Do celu
                            <small>Wyzwanie</small>
                        </label>
                    </div>
                </div>

                <input type="text" id="counter-name-input" placeholder="Nazwa licznika (np. Słodycze)" autocomplete="off">
                
                <div id="target-date-section" class="hidden">
                    <div class="tabs mini-tabs">
                        <button class="add-tab-btn active" data-tab="cal">Kalendarz</button>
                        <button class="add-tab-btn" data-tab="dur">Czas</button>
                    </div>

                    <div id="add-tab-cal" class="add-tab-content active">
                        <label class="input-label">Wybierz datę celu:</label>
                        <input type="datetime-local" id="new-counter-target">
                    </div>

                    <div id="add-tab-dur" class="add-tab-content">
                        <label class="input-label">Za ile czasu (od teraz)?</label>
                        <div class="duration-selects">
                            <select id="target-years"></select>
                            <select id="target-days"></select>
                            <select id="target-mins"></select>
                        </div>
                    </div>
                </div>

                <div class="modal-actions">
                    <button id="cancel-add" class="btn btn-secondary">Anuluj</button>
                    <button id="confirm-add" class="btn btn-primary">Zapisz</button>
                </div>
            </div>
        </div>

        <!-- Date Picker Modal (Editing existing) -->
        <div id="modal-date-picker" class="modal">
            <div class="modal-content">
                <h3>Ustaw datę</h3>
                
                <div class="tabs">
                    <button class="tab-btn active" data-tab="calendar">Kalendarz</button>
                    <button class="tab-btn" data-tab="duration">Wpisz czas</button>
                </div>

                <div id="tab-calendar" class="tab-content active">
                    <label class="input-label">Wybierz z kalendarza:</label>
                    <input type="datetime-local" id="manual-date-input">
                </div>

                <div id="tab-duration" class="tab-content">
                    <p class="small-info">Ile czasu temu to nastąpiło?</p>
                    <div class="duration-selects">
                        <select id="input-years"></select>
                        <select id="input-days"></select>
                        <select id="input-mins"></select>
                    </div>
                </div>

                <div class="modal-actions">
                    <button id="cancel-date" class="btn btn-secondary">Anuluj</button>
                    <button id="confirm-date" class="btn btn-primary">Ustaw</button>
                </div>
            </div>
        </div>

        <!-- Options Menu -->
        <div id="menu-options" class="modal">
            <div class="modal-content menu-content">
                <div class="sheet-header">
                    <h3 style="margin-bottom: 0;">Opcje Licznika</h3>
                    <button id="close-menu" class="btn-icon"><i class="fas fa-times"></i></button>
                </div>
                
                <hr class="separator" style="margin-top: 5px;">

                <button id="opt-rename" class="sheet-btn">
                    <i class="fas fa-edit"></i> Zmień nazwę
                </button>

                <button id="opt-date" class="sheet-btn">
                    <i class="fas fa-calendar-day"></i> Zmień datę / czas
                </button>
                
                <button id="opt-giveup" class="sheet-btn danger-text">
                    <i class="fas fa-times-circle"></i> Zakończ passę
                </button>
                
                <hr class="separator">
                
                <button id="opt-delete" class="sheet-btn danger-text">
                    <i class="fas fa-trash-alt"></i> Usuń licznik
                </button>
            </div>
        </div>
    </div>
    
    <script src="script.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./service-worker.js')
            .then(() => console.log('Service Worker Registered'));
        }
    </script>
</body>
</html>
